@using Common.Components.Templates;
@using Common.Enumerations;
@using Common.Models
@using Microsoft.AspNetCore.Components.Web
@typeparam T
@inherits BaseComponent

<div class=@_builder @onfocusout=Reset>
    <NavTemplate Model=Title />
    @if (Templates is not null && Templates.Any())
    {
        <div class=@($"common__dropdown__content{(_isDisplayed ? "" : " hidden")}")>
            @foreach (var item in Templates)
            {
                @ContentTemplate(item)
            }
        </div>
    }
</div>

@code {
    private bool _isDisplayed = false;

    [Parameter]
    public NavModel? Title { get; set; }
    [Parameter]
    public IEnumerable<T>? Templates { get; set; } = new T[0];
    [Parameter, EditorRequired]
    public RenderFragment<T> ContentTemplate { get; set; }

    protected override void OnInitialized()
    {
        _ = _builder.Append("common__dropdown");
        base.OnInitialized();
    }

    private void Reset()
    {
        UpdateDisplay(false);
    }

    private void DisplayDropDown()
    {
        UpdateDisplay(!_isDisplayed);
    }

    private void UpdateDisplay(bool isDisplayed)
    {
        _isDisplayed = isDisplayed;
        StateHasChanged();
    }
}
